<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<link rel="stylesheet" type="text/css" href="manual.css">
<title>Prune User's Manual</title>
</head>

<body>

<div id="manual">
<h1>Prune User's Manual</h1>

<p style="text-align: right;"><b>Last edited: May 2015</b></p>

<p>Prune is Copyright (C) 2003-2004 Douglas Thain and Copyright (C) 2005- The University of Notre Dame.<br>
All rights reserved.<br>
This software is distributed under the GNU General Public License.<br>
See the file COPYING for details.</p>


<h2 id="overview">Overview<a class="sectionlink" href="#overview" title="Link to this section.">&#x21d7;</a></h2>

<p>Prune is a system for executing and precisely preserving scientific workflows.
Collaborators can verifiy research results and easily extend them
at a granularity that makes sense to users,
since the granularity was determined by a user.</p>


<h2 id="overview">Commands<a class="sectionlink" href="#overview" title="Link to this section.">&#x21d7;</a></h2>


<p>The following basic commands are fundamental to PRUNE:</p>

<ul>
  <li>
    <p>PUT [local.txt] AS [prune_name]: Files to be used in the workflow can be added to the preserved namespace.
    <br>Ex. PUT mylocalfilename.txt AS data_name_in_prune</p>
  </li>
  <li>
    <p>EVAL &lt;name(s)&gt; = &lt;expression&gt; (default): Evaluate an expression and assign the results to the specified name(s). Work defined in these statements will not be executed until control is passes to PRUNE such as with USE and WORK commands.
    <br>Ex. sorted_data = sort(input_data)</p>
  </li>
  <li>
    <p>USE &lt;framework&gt; [&lt;arguments&gt;]: Define how the execution should be performed
    <br>Ex. USE wq prune      #Start and use a Work Queue master with the name 'prune'
    <br>Ex. USE local 1      	#Use 1 local execution thread</p>
  </li>
  <li>
    <p>WORK [FOR &lt;timeout&gt;]: Blocking function that instructs PRUNE to start executing the workflow with whatever resources are available.
    <br>Ex. WORK FOR 60    #Block for 60 seconds so PRUNE can work</timeout>
  </li>
  <li>
    <p>GET [prune_name] AS [local.txt]: Files generated by the workflow can be put into the user's namespace for use by some external program.
    <br>Ex. GET data_name_in_prune AS mylocalfilename.txt</p>
  </li>
</ul>


<p>Functions are currently defined within a script file (which is PUT in the system) to define the types of arguments the script expects and the output files that should be preserved.
<br>Ex.  #PRUNE_INPUTS File File Text
<br>Ex.  #PRUNE_OUTPUT outfile1.txt
<br>Ex.  #PRUNE_OUTPUT outfile2.txt
</p>


<h2 id="overview">Additional commands<a class="sectionlink" href="#overview" title="Link to this section.">&#x21d7;</a></h2>


<p>The following commands are also available for convenience:</p>

<ul>
  <li>
    MF <name>: Covert the makeflow rules in the file into PRUNE function invocations.
  </li>
  <li>
    RUN <name>: Treat each line in a file as if it were typed into the PRUNE interface.
  </li>
  <li>
    RESET: Truncate the database and delete and data files and sandboxes.
  </li>
  <li>
    LOCATE <name>: Show where the file is cached in PRUNE (if available)
  </li>
  <li>
    ENV <prune_name>: Define the environment in which an execution should be performed
    <!--<br>Ex. PUT spec.json AS cms_env ENV umbrella     #Use the umbrella specification -->
    <br>Ex. PUT env.tar.gz AS py_libs ENV targz     #Extract the file containing libraries
    <!--<br>Ex. ENV cms_env               #Switch back to the umbrella environment-->
  </li>
  <li>
    ENV <prune_name>: Define the environment in which an execution should be performed
    <!--<br>Ex. PUT spec.json AS cms_env ENV umbrella     #Use the umbrella specification -->
    <br>Ex. PUT env.tar.gz AS py_libs ENV targz     #Extract the file containing libraries
    <!--<br>Ex. ENV cms_env               #Switch back to the umbrella environment-->
  </li>
  <li>
    FAILURES|RUNNING: List operations that failed or are currently running
    <br>Ex. FAILURES
    <br>1: n = sort(nouns)
  </li>
  <li>
    CANCEL|RETRY: Cancel an operation, or retry a failed one.
    <br>Ex. RETRY 1
  </li>
</ul>



<h2 id="overview">Notes<a class="sectionlink" href="#overview" title="Link to this section.">&#x21d7;</a></h2>


  <p>When PRUNE is started using the "prune" executable, an interface becomes available for the user to type commands. Ctrl-C will terminate PRUNE and upon restarting any previously running tasks revert to the "Run" status.</p>

  <p>The user will be initially prompted to specify locations for a database file, data folder, and sandbox folder. This meta-data will be stored in the working directory as a file named .prune.conf for PRUNE to use later.</p>


<h2 id="overview">Example: Merge Sort<a class="sectionlink" href="#overview" title="Link to this section.">&#x21d7;</a></h2>


  <p>Here is a full example of a merge sort in PRUNE:</p>

  <code style="margin-right: auto;">
    <span class="prompt">$ </span> prune
    <span class="prompt">$ </span> PUT sort.sh AS sort
    <span class="prompt">$ </span> PUT merge.sh AS merge
    <span class="prompt">$ </span> PUT nouns.txt AS nouns
    <span class="prompt">$ </span> PUT verbs.txt AS verbs
    <span class="prompt">$ </span> n = sort(nouns)
    <span class="prompt">$ </span> v = sort(verbs)
    <span class="prompt">$ </span> merged_result = merge(n,v)
    <span class="prompt">$ </span> USE wq prune
    Work Queue master started on port 9001 with name 'prune'...
    <span class="prompt">$ </span> WORK
    ...
    PRUNE finished work in: 01m16s
    <span class="prompt">$ </span> GET merged_result AS test.txt
  </code>


<p>Contents of the file "sort.sh":</p>  
<code style="margin-right: auto;">#!/bin/bash
  #PRUNE_INPUTS File
  #PRUNE_OUTPUT sorted_data.txt
  sort $1 > sorted_data.txt
</code>

<p>Contents of the file "merge.sh":</p>  
<code style="margin-right: auto;">#!/bin/bash
  #PRUNE_INPUTS File*
  #PRUNE_OUTPUT merged_output.txt
  sort -m $@ > merged_output.txt 
</code>
