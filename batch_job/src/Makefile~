include ../../config.mk
include ../../rules.mk

LIBRARIES = libbatch_job.a

PROGRAMS = work_queue_pool

EXTERNAL_LIBRARIES = ../../work_queue/src/libwork_queue.a ../../dttools/src/libdttools.a ../../chirp/src/libchirp.a

SOURCES = \
	batch_job.c \
	batch_job_chirp.c \
	batch_job_cluster.c \
	batch_job_condor.c \
	batch_job_local.c \
	batch_job_work_queue.c

PUBLIC_HEADERS = batch_job.h

OBJECTS = $(SOURCES:%.c=%.o)

libbatch_job.a: $(OBJECTS)

work_queue_pool: libbatch_job.a work_queue_pool.o $(EXTERNAL_LIBRARIES)
	$(LD) $^ $(LDFLAGS) -o $@

all: $(LIBRARIES) $(PROGRAMS)

install:
	mkdir -p $(CCTOOLS_INSTALL_DIR)/bin
	cp $(PROGRAMS) $(CCTOOLS_INSTALL_DIR)/bin
	mkdir -p $(CCTOOLS_INSTALL_DIR)/lib
	cp $(LIBRARIES) $(CCTOOLS_INSTALL_DIR)/lib
	mkdir -p $(CCTOOLS_INSTALL_DIR)/include/cctools
	cp $(PUBLIC_HEADERS) $(CCTOOLS_INSTALL_DIR)/include/cctools

clean:
	rm -rf $(OBJECTS) $(LIBRARIES) $(PROGRAMS)
