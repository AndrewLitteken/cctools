#!/bin/sh

if [ "$#" -ne 1 ]; then
	echo "use: $0 <config-file>"
	exit 1
fi

configFile=$1

echo "Loading config file $config..."
if [ ! -f $configFile ]
then
	echo "$0: config file $configFile not found"
	exit 1
fi

security_group_id=$(python -c "import json; print json.load(open('$configFile','r'))['security_group_id'];")
keypair_name=$(python -c "import json; print json.load(open('$configFile','r'))['keypair_name'];")

echo -n "Checking for aws command in PATH..."
if which aws >/dev/null 2>&1
then
        echo "ok"
else
        echo "failed"
        echo "$0: \"aws\" command must be in your path to use this script."
        exit 1
fi

echo "Deleting keypair $keypair_name..."
aws ec2 delete-key-pair --key-name $keypair_name
rm -f $keypair_name.pem

echo "Deleting security group $security_group..."
aws ec2 delete-security-group --group-id $security_group_id

#echo "Deleting subnet $EC2_SUBNET..."
#aws ec2 delete-subnet --subnet-id $EC2_SUBNET

#echo "Deleting route table $EC2_ROUTE_TABLE..."
#aws ec2 delete-route-table --route-table-id $EC2_ROUTE_TABLE

#echo "Deleting internet gateway $EC2_GATEWAY..."
#aws ec2 delete-internet-gateway --gateway-id $EC2_GATEWAY"

#echo "Deleting virtual private cluster $EC2_VPC..."
#aws ec2 delete-vpc --vpc-id $EC2_VPC

echo "Done!"
